<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta name="apple-mobile-web-app-capable" content="yes">
	</head>
	
	<canvas id=canvas width=320px height=460px style='border:1px solid black;position:absolute;top:0px;left:0px'>
	</canvas>
	<script>
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		function pre_preload(){
			if(window.innerHeight > window.innerWidth){preload()}
			else{alert('Please hold the device vertically')
			setTimeout(pre_preload,3000)}
		}
		window.onload=pre_preload()
		function preload(){
			canvas_width = window.innerWidth;
			canvas_height = window.innerHeight;
			canvas.setAttribute('width',canvas_width)
			canvas.setAttribute('height',canvas_height)
			load_images()
		}
		function load_images(){
			handle_image_load()
		}
		function handle_image_load(){
			var num_of_images = num_of_images||0;
			num_of_images ++
			if(num_of_images == 1){init()}
		}
		//
		//
		//
		//
		//
		var alpha = 0
		var beta;
		var gamma;
		var level = 1
		var box1_red = 255
		var box1_green = 255
		var box1_blue = 255
		function init(){
			change_bg_color()
			game_loop()
		}
		
		function game_loop(){
			draw_background()
			draw_box()
			calc_diff()
			requestAnimationFrame(game_loop)
		}
		function draw_background(){
			ctx.fillStyle=background_color;
			ctx.fillRect(0,0,canvas_width,canvas_height)
		}
		function draw_box(){
			var x = canvas_width/4
			var y = x*5/4
			
			
			
			ctx.fillStyle='rgb('+box1_red+','+box1_green+','+box1_blue+')'
			ctx.fillRect(x,y,2*x,8/3*y)
			//console.log(box1_color)
		}
		
		function change_bg_color(){
			
				c1 = Math.floor(Math.random()*90)+82
				c2 = Math.floor(Math.random()*90)+82
				c3 = Math.floor(Math.random()*90)+82
			
			background_color = 'rgb('+c1+','+c2+','+c3+')'
		}
		function calc_diff(){
			if(Math.abs(c1-box1_red) < 5 && Math.abs(c2-box1_green) < 5 && Math.abs(c3-box1_blue) < 5){win()}
		}
		function win(){
			alert('win')
			level++
			change_bg_color()
		}
		document.addEventListener('touchstart',log,false)
		function log(){alert(alpha);
					   alert(beta);
					   alert(gamma)
					  }
		
		var alpha_old = alpha;
		var beta_old = beta;
		var gamma_old = gamma;
		
		window.ondeviceorientation = function (e){
			console.log('alpha: '+alpha)
			alpha = Math.floor(e.alpha) //Tilt (y-axis) in degrees
			beta = Math.floor(e.beta) //Tilt (z-axis)in degrees
			gamma = Math.floor(e.gamma) //Tilt (x-axis)
			
			if(alpha-alpha_old >= 5){box1_red += 5}
			else if(alpha_old-alpha >= 5){box1_red -= 5}
			if(beta-beta_old >= 5){box1_green += 5}
			else if(beta_old-beta >=5){box1_green -= 5}
			if(gamma-gamma_old >= 5){box1_blue += 5}
			else if(gamma_old-gamma >= 5){box1_blue -= 5}
			
			
			alpha_old = alpha;
			beta_old = beta;
			gamma_old = gamma;
		}
	</script>
</html>