
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<style id=style onload=windowSize()>

		#canvas {
				position:absolute;
				top:-2px;
				left:-2px;}
		p {
				position:relative;
				top:480px;
				
		}
	</style>
	
	
</head>
<body>
	<canvas id=canvas width=360px height=480px style='border:1px solid black'></canvas>
	<p>Instructions: Click or touch the balloons to pop them. Once a balloon is popped, its value will be added to the equation. Fill in all the question marks (?) in the equation to add up exactly to the goal number!</p>
	
	<script type='text/javascript' id='script'>
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var mobileUser = false;
		var score = 0;
		var balloons = []
		var balloon_h = 66
		var balloon_w = 50
		var balloon_x_var = 0;
		var popped_this_click = false;
		var equ = []
		var result = 0
		var f_result = 0
		var cloud1_x = 240
		var cloud1_y = 100
		var cloud2_x = 100
		var cloud2_y = 340
		var cloud_w = 296
		var bad_equation = false;
		var level = 0
		var level_array = [
					[8,'?','+','?','+','?'],
					[10,'3','+','?','-','?'],
					[12,'1','+','?','?','9'],
					[13,'4','2','?','?','?'],
					[15,'2','?','?','?','4'],
					[17,'?','+','?','+','?'],
						  ]
		
		function windowSize(){
			console.log('get size')
			window_w = window.innerWidth;
			window_h = window.innerHeight;
			//document.getElementById('canvas').style.height=window_h;
			//document.getElementById('canvas').style.width=window_w;
			if(window_w < 480){mobileUser = true;
				document.getElementById('canvas').style.height=window_h;
				document.getElementById('canvas').style.width=window_w;
			}
			preload()
		}
		
		window.onorientationchange=function(){location.reload(true)}
		
		
		function preload(){
			console.log('preloading...')
			alert('Version 1.4\nInstructions: Click or touch the balloons to pop them.\nOnce a balloon is popped, its value will be added to the equation.\nFill in all the question marks (?) in the equation to add up exactly to the goal number!\nBe careful not to pop the blue balloons!'
				 
				 )
			balloon_red = new Image();
			balloon_red.src = 'balloon_red1.png'
			balloon_blue = new Image();
			balloon_blue.src = 'balloon_blue1.png'
			balloon_green = new Image();
			balloon_green.src = 'balloon_green1.png'
			cloud = new Image()
			cloud.src = 'cloud.png'
			init()
		}
		
		
		
		
		
		
		
		function drawBackground(){
			ctx.fillStyle='#4182ff'
			ctx.fillRect(0,0,360,480)
			ctx.drawImage(cloud,cloud1_x,cloud1_y)
			ctx.drawImage(cloud,cloud2_x,cloud2_y)
			cloud1_x --;
			cloud2_x ++;
			if(cloud2_x > 360){cloud2_x = -cloud_w - Math.floor(Math.random()*100);cloud2_y = 300 + Math.floor(Math.random()*100)}
			if(cloud1_x < -cloud_w){cloud1_x = 360 + Math.floor(Math.random()*100);cloud1_y = 50 + Math.floor(Math.random()*100)}
		}
		
		function drawGoal(){
			goal = level_array[level][0]
			if (equ[0] == '?' || equ[1] == '?' || equ[2] == '?'){bad_equation = false}
			
			
			ctx.fillStyle='#000'
			ctx.fillText(equ[0],20,475)
			ctx.fillText(equ[1],60,475)
			ctx.fillText(equ[2],100,475)
			ctx.fillText(equ[3],140,475)
			ctx.fillText(equ[4],180,475)
		
			ctx.fillText('=',240,475)
			ctx.fillText(goal,300,475)
		}
		
		function compute_equation(){
			result = 0 + equ[0] + equ[1] + equ[2] + equ[3] + equ[4]
			
			if(equ[4] == '*' || equ[4] == '/' || equ[4] == '+' || equ[4] == '-'){bad_equation = true;}
			else if((equ[0] == '*' || equ[0] == '/' || equ[0] == '+' || equ[0] == '-') && (equ[1] == '*' || equ[1] == '/' || equ[1] == '+' || equ[1] == '-')){bad_equation = true}
			else if((equ[1] == '*' || equ[1] == '/' || equ[1] == '+' || equ[1] == '-') && (equ[2] == '*' || equ[2] == '/' || equ[2] == '+' || equ[2] == '-')){bad_equation = true}
			else if((equ[2] == '*' || equ[2] == '/' || equ[2] == '+' || equ[2] == '-') && (equ[3] == '*' || equ[3] == '/' || equ[3] == '+' || equ[3] == '-')){bad_equation = true}
			else{bad_equation = false}
			if(!bad_equation){
				f_result = eval(result);
			}
			if(f_result != goal && equ[4] != undefined){change_to_equation();score-=7;result=0}
			else if(f_result == goal && equ[4] != undefined){win()}
		}
		
		function win(){
			alert('Hoorah!')
			balloons = []
			equ = []
			bad_equation = false;
			result = 0
			f_result = 0
			score += 10*level
			level++
			change_to_equation()
		}
		
		function drawBalloons(){
			balloon_x_var+=.05
			for (i=0;i<balloons.length;i++){
				ctx.font='28px Georgia'
				ctx.fillStyle = 'yellow'
				
				balloons[i][1] --;
				
				if (balloons[i][2] == 'r') {
					balloons[i][0] += Math.sin(balloon_x_var)*2
					ctx.drawImage(balloon_red,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				else if(balloons[i][2] == 'g') {
					balloons[i][0] += Math.cos(balloon_x_var)*2
					ctx.drawImage(balloon_green,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				else if(balloons[i][2] == 'b') {
					balloons[i][0] += Math.sin(balloon_x_var/2)*4
					ctx.drawImage(balloon_blue,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				
				   
			}
		}
		
	
		var space = false
	function keyDown(evt) {
			if (evt.keyCode == 76){log()}
		}

		document.onkeydown=keyDown
		
		document.addEventListener('touchstart', function(e){
		for (i=balloons.length - 1;i>=0;i--){
			if(e.changedTouches[0].clientX < balloons[i][0] + balloon_w + 12 &&
				e.changedTouches[0].clientX> balloons[i][0] - 12 &&
				e.changedTouches[0].clientY < balloons[i][1] + balloon_h + 12 &&
				e.changedTouches[0].clientY > balloons[i][1] - 12){
												//animate balloon popping here!
				if(!popped_this_click){
					popped_this_click = true;
					if (balloons[i][3] != 'X'){
						equ.push(balloons[i][3]);
						score++;
						balloons_popped ++
					}
					else{score -= 15}
					balloons.splice(i,1);
				}
			}
		}
		
		})
		
		document.addEventListener('click', function(e){
		for (i=balloons.length - 1;i>=0;i--){
			if(e.clientX < balloons[i][0] + balloon_w + 10 &&
				e.clientX> balloons[i][0] -10 &&
				e.clientY < balloons[i][1] + balloon_h + 10 &&
				e.clientY > balloons[i][1] -10){
												//animate balloon popping here!
				if(!popped_this_click){
					popped_this_click = true;
					if (balloons[i][3] != 'X'){
						//equ.push(balloons[i][3]);
						score++;
						
						if (equ[0] == '?'){equ[0] = balloons[i][3]}
						else if (equ[1] == '?'){equ[1] = balloons[i][3]}
						else if (equ[2] == '?'){equ[2] = balloons[i][3]}
						else if (equ[3] == '?' && equ[4] != '?'){equ[3] = balloons[i][3];compute_equation();}
						else if (equ[3] == '?'){equ[3] = balloons[i][3]}
						else if (equ[4] == '?'){equ[4] = balloons[i][3];compute_equation();}
					}
					else{score -= 15}
					balloons.splice(i,1);
				}
			}
		}
		
		})
		document.addEventListener('touchend', function(){popped_this_click=false})
		document.onmouseup=function(){popped_this_click=false}
		
		
		function change_to_equation(){
			equ[0] = level_array[level][1];
			equ[1] = level_array[level][2];
			equ[2] = level_array[level][3];
			equ[3] = level_array[level][4];
			equ[4] = level_array[level][5];
			bad_equation = false;
		}
		
	
	
		//check for collisions
	function checkCollision(){
		for (i=0;i<balloons.length;i++){
			if (balloons[i][1] < -balloon_h){
				balloons.splice(i,1)
			}
		}
	}
	function gameOver(){
		if(localStorage.getItem('balloon_score')){
			if (score > localStorage.getItem('balloon_score')){localStorage.setItem('balloon_score',score)}
			var highscore = localStorage.getItem('balloon_score')
		}
		else{localStorage.setItem('balloon_score',score)}
			alert('Game Over\nYour score: '+score+'\nHighscore: '+highscore)
			score = 0
	}

	function updateScore(){
			
			ctx.fillStyle = 'yellow'
			ctx.font='28px Georgia'
			ctx.fillText('Score: '+score,25,25)
		}
		//loop game
	function gameLoop(){
			ctx.clearRect(0,0,720,480)
			drawBackground()
			drawBalloons()
			drawGoal()
			//compute_equation()
			updateScore()
			checkCollision()
			requestAnimationFrame(gameLoop)
		}
		//initialize game
	function init(){
			startBalloons()
			gameLoop()
			change_to_equation()
		}
	
	function startBalloons(){
			setInterval(function(){
				var t = Math.floor(Math.random()*4)+1;
				var s;
				switch(t){
					case 1:
						s = '+'
						break;
					case 2:
						s = '-'
						break;
					case 3:
						s = '/'
						break;
					case 4:
						s = '*'
						break;
				}
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'r',Math.floor((Math.random()*9)+1)])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'b','X'])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'g',s])
			//if(score > 50){balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'r'])}
			},1500)
		}	
		
	function log(){
			console.log(result)
			console.log(f_result)
		}
	</script>
</body>
</html>
