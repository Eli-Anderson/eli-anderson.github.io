
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<style id=style onload=windowSize()>

		#canvas {
				position:absolute;
				top:-2px;
				left:-2px;}
	</style>
	
	
</head>
<body>
	<canvas id=canvas width=360px height=480px style='border:1px solid black'></canvas>

	
	<script type='text/javascript' id='script'>
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var mobileUser = false;
		var score = 0;
		var balloons = []
		var balloon_h = 66
		var balloon_w = 50
		var balloon_x_var = 0;
		var popped_this_click = false;

		
		function windowSize(){
			console.log('get size')
			window_w = window.innerWidth;
			window_h = window.innerHeight;
			//document.getElementById('canvas').style.height=window_h;
			//document.getElementById('canvas').style.width=window_w;
			if(window_w < 480){mobileUser = true;
				document.getElementById('canvas').style.height=window_h;
				document.getElementById('canvas').style.width=window_w;
			}
			preload()
		}
		
		window.onorientationchange=function(){location.reload(true)}
		
		
		function preload(){
			console.log('preloading...')
			balloon_red = new Image();
			balloon_red.src = 'balloon_red1.png'
			balloon_blue = new Image();
			balloon_blue.src = 'balloon_blue1.png'
			balloon_green = new Image();
			balloon_green.src = 'balloon_green1.png'
			if(mobileUser){alert('Version 1.1')}
			init()
		}
		
		
		function drawBackground(){
			ctx.fillStyle='#6d9fff'
			ctx.fillRect(0,0,360,480)
		}
//62x68
		function drawBalloons(){
			balloon_x_var+=.1
			for (i=0;i<balloons.length;i++){
				balloons[i][1] --;
				
				if (balloons[i][2] == 'r') {
					balloons[i][0] += Math.sin(balloon_x_var)*2
					ctx.drawImage(balloon_red,balloons[i][0],balloons[i][1])
					ctx.font='28px Georgia'
					var t = Math.floor(Math.random()*8)+1
					ctx.fillText('t',balloons[i][0],balloons[i][1])
				}
				
				else if(balloons[i][2] == 'g') {
					balloons[i][0] += Math.cos(balloon_x_var)*2
					ctx.drawImage(balloon_green,balloons[i][0],balloons[i][1])
				}
				
				else if(balloons[i][2] == 'b') {
					balloons[i][0] += Math.sin(balloon_x_var/2)*4
					ctx.drawImage(balloon_blue,balloons[i][0],balloons[i][1])
				}
				
				
				   
			}
		}
		
	
		var space = false
	function keyDown(evt) {
			if (evt.keyCode == 76){log()}
		}

		document.onkeydown=keyDown
		
		document.addEventListener('touchstart', function(e){
		for (i=balloons.length - 1;i>=0;i--){
			if(e.changedTouches[0].clientX < balloons[i][0] + balloon_w + 12 &&
				e.changedTouches[0].clientX> balloons[i][0] - 12 &&
				e.changedTouches[0].clientY < balloons[i][1] + balloon_h + 12 &&
				e.changedTouches[0].clientY > balloons[i][1] - 12){
												//animate balloon popping here!
				if(!popped_this_click){popped_this_click = true;balloons.splice(i,1);score++}
			}
		}
		
		})
		
		document.addEventListener('click', function(e){
		for (i=balloons.length - 1;i>=0;i--){
			if(e.clientX < balloons[i][0] + balloon_w + 10 &&
				e.clientX> balloons[i][0] -10 &&
				e.clientY < balloons[i][1] + balloon_h + 10 &&
				e.clientY > balloons[i][1] -10){
												//animate balloon popping here!
				if(!popped_this_click){popped_this_click = true;balloons.splice(i,1);score++}
			}
		}
		
		})
		document.addEventListener('touchend', function(){popped_this_click=false})
		document.onmouseup=function(){popped_this_click=false}
		
		

		
	
	
		//check for collisions
	function checkCollision(){
		for (i=0;i<balloons.length;i++){
			if (balloons[i][1] < -balloon_h){
				//balloons = []
				//gameOver()
			}
		}
	}
	function gameOver(){
		if(localStorage.getItem('balloon_score')){
			if (score > localStorage.getItem('balloon_score')){localStorage.setItem('balloon_score',score)}
			var highscore = localStorage.getItem('balloon_score')
		}
		else{localStorage.setItem('balloon_score',score)}
			alert('Game Over\nYour score: '+score+'\nHighscore: '+highscore)
			score = 0
	}

	function updateScore(){
			
			ctx.fillStyle = 'yellow'
			ctx.font='28px Georgia'
			ctx.fillText('Score: '+score,25,25)
		}
		//loop game
	function gameLoop(){
			ctx.clearRect(0,0,720,480)
			drawBackground()
			drawBalloons()
			
			updateScore()
			checkCollision()
			requestAnimationFrame(gameLoop)
		}
		//initialize game
	function init(){
			startBalloons()
			gameLoop()
		}
	
	function startBalloons(){
			setInterval(function(){
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'r'])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'b'])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'g'])
			if(score > 50){balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'r'])}
			},1500)
		}	
		
	function log(){
			
		}
	</script>
</body>
</html>
