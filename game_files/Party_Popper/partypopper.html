
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<style id=style onload=windowSize()>

		#canvas {
				position:absolute;
				top:-2px;
				left:-2px;}
		
	</style>
	
	
</head>
<body>
	<canvas id=canvas width=640px height=960px style='border:1px solid black'></canvas>
	
	<script type='text/javascript' id='script'>
		var version_number = 1.5
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var mobileUser = false;
		var score = 0;
		var balloons = []
		var balloon_h = 66
		var balloon_w = 50
		var balloon_x_var = 0;
		var popped_this_click = false;
		var equ = []
		var result = 0
		var f_result = 0
		var cloud1_x = 240
		var cloud1_y = 100
		var cloud2_x = 100
		var cloud2_y = 340
		var cloud_w = 296
		var bad_equation = false;
		var level = 0
		var level_array = [
					[8,'?','+','?','+','?'],
					[10,'3','+','?','-','?'],
					[12,'1','+','?','?','9'],
					[13,'4','2','?','?','?'],
					[15,'2','?','?','?','4'],
					[17,'?','+','?','+','?'],
						  ]
		var at_menu_screen = true;
		var at_help_screen = false;
		var play_button;
		var help_button;
		var help_page = 0;
		
		function windowSize(){
			console.log('get size')
			window_w = window.innerWidth;
			window_h = window.innerHeight;
			//window_w = window_h * 3/4
			//document.getElementById('canvas').style.width=window_w;
			//document.getElementById('canvas').style.height=window_h;
			if(window_w < 480){mobileUser = true;
				document.getElementById('canvas').style.height=window_h;
				document.getElementById('canvas').style.width=window_w;
			}
			preload()
		}
		
		window.onorientationchange=function(){location.reload(true)}
		
		
		function preload(){
			console.log('preloading...')
			
				 
				 
			balloon_red = new Image();
			balloon_red.src = 'balloon_red1.png'
			balloon_red2 = new Image();
			balloon_red2.src = 'balloon_red2.png'
			balloon_red3 = new Image();
			balloon_red3.src = 'balloon_red3.png'
			balloon_red4 = new Image();
			balloon_red4.src = 'balloon_red4.png'
			balloon_red5 = new Image();
			balloon_red5.src = 'balloon_red5.png'
			balloon_red6 = new Image();
			balloon_red6.src = 'balloon_red6.png'
			balloon_red7 = new Image();
			balloon_red7.src = 'balloon_red7.png'
			
			balloon_blue = new Image();
			balloon_blue.src = 'balloon_blue1.png'
			balloon_green = new Image();
			balloon_green.src = 'balloon_green1.png'
			cloud = new Image();
			cloud.src = 'cloud.png'
			arrow = new Image();
			arrow.src = 'arrow.png'
			init()
		}
		
		
		
		
			
		function main_menu(){
			
			ctx.fillStyle='rgba(0,0,0,0.5)'
			ctx.fillRect(0,0,360,480)
			
			ctx.fillStyle='rgba(0,0,0,0.4)'
			ctx.fillRect(30,30,300,420)
			
			if(!at_help_screen){
			
			ctx.fillStyle='white'
			ctx.font='42px Georgia'
			ctx.fillText('Party Popper',60,80)
			
			ctx.fillStyle='rgba(0,0,0,0.3)'
			ctx.fillRect(90,200,180,60)
				play_button = {x:90,y:200,w:180,h:60,f:function(){at_menu_screen=false;}}
			ctx.fillRect(90,300,180,60)
				help_button = {x:90,y:300,w:180,h:60}
			
			ctx.fillStyle='white'
			ctx.font='30px Georgia'
			ctx.fillText('Play',150,240)
			ctx.fillText('How to play',100,340)
			}
			if (at_help_screen){
				ctx.fillStyle='white'
				ctx.font='24px Georgia'
				ctx.fillText('Version '+version_number,120,80)
				ctx.fillText('Click or tap to continue',60,440)
				switch(help_page){
					case 1:
						ctx.fillText('Click or touch the',80,200)
						ctx.fillText('balloons to pop them.',60,240)
						break;
					case 2:
						ctx.fillText('Once a balloon is',80,200)
						ctx.fillText('popped, its value will',70,240)
						ctx.fillText('be added to the',90,280)
						ctx.fillText('equation',130,320)
						ctx.fillText('?     +     3     +     ?',20,475)
						ctx.drawImage(arrow,155,350)
						ctx.save()
						//ctx.translate(0,350)
						ctx.rotate(45*Math.PI/180)
						ctx.drawImage(arrow,310,190)
						ctx.restore()
						break;
					case 3:
						ctx.fillText('Fill in all the',110,200)
						ctx.fillText('question marks (?)',85,240)
						ctx.fillText('in the equation to',90,280)
						ctx.fillText('add up exactly to',90,320)
						ctx.fillText('the goal number!',90,360)
						ctx.fillText('=     10',260,475)
						ctx.drawImage(arrow,275,350)
						break;
					case 4:
						ctx.fillText('Beware of the blue',85,200)
						ctx.fillText('balloons; they will',85,240)
						ctx.fillText('take away from your',70,280)
						ctx.fillText('score!',150,320)
						break;
					case 5:
						at_help_screen = false;
						help_page = 0
				}
			//Fill in all the question marks (?) in the equation to add up exactly to the goal number!\nBe careful not to pop the blue balloons!',60,80)
			
			}
			
			
		}
		
		
		
		
		function drawBackground(){
			ctx.fillStyle='#4182ff'
			ctx.fillRect(0,0,360,480)
			ctx.drawImage(cloud,cloud1_x,cloud1_y)
			ctx.drawImage(cloud,cloud2_x,cloud2_y)
			cloud1_x --;
			cloud2_x ++;
			if(cloud2_x > 360){cloud2_x = -cloud_w - Math.floor(Math.random()*100);cloud2_y = 300 + Math.floor(Math.random()*100)}
			if(cloud1_x < -cloud_w){cloud1_x = 360 + Math.floor(Math.random()*100);cloud1_y = 50 + Math.floor(Math.random()*100)}
		}
		
		function drawGoal(){
			goal = level_array[level][0]
			if (equ[0] == '?' || equ[1] == '?' || equ[2] == '?'){bad_equation = false}
			
			
			ctx.fillStyle='#000'
			ctx.fillText(equ[0],20,475)
			ctx.fillText(equ[1],60,475)
			ctx.fillText(equ[2],100,475)
			ctx.fillText(equ[3],140,475)
			ctx.fillText(equ[4],180,475)
		
			ctx.fillText('=',240,475)
			ctx.fillText(goal,300,475)
		}
		
		function compute_equation(){
			result = String(equ[0] + equ[1] + equ[2] + equ[3] + equ[4])
			
			if(equ[4] == '*' || equ[4] == '/' || equ[4] == '+' || equ[4] == '-'){bad_equation = true;}
			else if((equ[0] == '*' || equ[0] == '/' || equ[0] == '+' || equ[0] == '-') && (equ[1] == '*' || equ[1] == '/' || equ[1] == '+' || equ[1] == '-')){bad_equation = true}
			else if((equ[1] == '*' || equ[1] == '/' || equ[1] == '+' || equ[1] == '-') && (equ[2] == '*' || equ[2] == '/' || equ[2] == '+' || equ[2] == '-')){bad_equation = true}
			else if((equ[2] == '*' || equ[2] == '/' || equ[2] == '+' || equ[2] == '-') && (equ[3] == '*' || equ[3] == '/' || equ[3] == '+' || equ[3] == '-')){bad_equation = true}
			else{bad_equation = false}
			if(!bad_equation){
				f_result = eval(result);
			}
			if(f_result != goal && equ[4] != undefined){change_to_equation();score-=7;result=0}
			else if(f_result == goal && equ[4] != undefined){win()}
		}
		
		function win(){
			alert('Hoorah!')
			balloons = []
			equ = []
			bad_equation = false;
			result = 0
			f_result = 0
			score += 10*level
			level++
			change_to_equation()
		}
		
		function drawBalloons(){
			balloon_x_var+=.05
			for (i=0;i<balloons.length;i++){
				ctx.font='28px Georgia'
				ctx.fillStyle = 'yellow'
				
				balloons[i][1] --;
				
				if (balloons[i][2] == 'r') {
					balloons[i][0] += Math.sin(balloon_x_var)*2
					ctx.drawImage(balloon_red,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				else if(balloons[i][2] == 'g') {
					balloons[i][0] += Math.cos(balloon_x_var)*2
					ctx.drawImage(balloon_green,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				else if(balloons[i][2] == 'b') {
					balloons[i][0] += Math.sin(balloon_x_var/2)*4
					ctx.drawImage(balloon_blue,balloons[i][0],balloons[i][1])
					ctx.fillText(balloons[i][3],balloons[i][0]+17,balloons[i][1]+36)
				}
				
				
				   
			}
		}
		
	
		var space = false
	function keyDown(evt) {
			if (evt.keyCode == 76){log()}
		}

		document.onkeydown=keyDown
		
		canvas.addEventListener('touchstart', function(e){
			if(at_menu_screen){
				if( e.changedTouches[0].clientX < play_button.x + play_button.w &&
					e.changedTouches[0].clientX > play_button.x &&
					e.changedTouches[0].clientY < play_button.y + play_button.h &&
					e.changedTouches[0].clientY > play_button.y){at_menu_screen = false;}
				
				if( e.changedTouches[0].clientX < help_button.x + help_button.w &&
					e.changedTouches[0].clientX > help_button.x &&
					e.changedTouches[0].clientY < help_button.y + help_button.h &&
					e.changedTouches[0].clientY > help_button.y){at_help_screen = true;}
				
				if(at_help_screen){help_page ++}
				}
			
			
		for (i=balloons.length - 1;i>=0;i--){
			if(e.changedTouches[0].clientX < balloons[i][0] + balloon_w + 12 &&
				e.changedTouches[0].clientX> balloons[i][0] - 12 &&
				e.changedTouches[0].clientY < balloons[i][1] + balloon_h + 12 &&
				e.changedTouches[0].clientY > balloons[i][1] - 12){
												//animate balloon popping here!
				if(!popped_this_click){
					popped_this_click = true;
					if (balloons[i][3] != 'X'){
						
						score++;
						
						if (equ[0] == '?'){equ[0] = balloons[i][3]}
						else if (equ[1] == '?'){equ[1] = balloons[i][3]}
						else if (equ[2] == '?'){equ[2] = balloons[i][3]}
						else if (equ[3] == '?' && equ[4] != '?'){equ[3] = balloons[i][3];compute_equation();}
						else if (equ[3] == '?'){equ[3] = balloons[i][3]}
						else if (equ[4] == '?'){equ[4] = balloons[i][3];compute_equation();}
					}
					else{score -= 15}
					balloons.splice(i,1);
				}
			}
		}
		
		})
		
		canvas.addEventListener('click', function(e){
			if(at_menu_screen){
				if( e.clientX < play_button.x + play_button.w &&
					e.clientX > play_button.x &&
					e.clientY < play_button.y + play_button.h &&
					e.clientY > play_button.y){at_menu_screen = false;}
				
				if( e.clientX < help_button.x + help_button.w &&
					e.clientX > help_button.x &&
					e.clientY < help_button.y + help_button.h &&
					e.clientY > help_button.y){at_help_screen = true;}
				
				if(at_help_screen){help_page ++}
				}
			
		
		for (i=balloons.length - 1;i>=0;i--){
			if(e.clientX < balloons[i][0] + balloon_w + 10 &&
				e.clientX> balloons[i][0] -10 &&
				e.clientY < balloons[i][1] + balloon_h + 10 &&
				e.clientY > balloons[i][1] -10){
												//animate balloon popping here!
				if(!popped_this_click){
					popped_this_click = true;
					if (balloons[i][3] != 'X'){
						
						score++;
						
						if (equ[0] == '?'){equ[0] = balloons[i][3]}
						else if (equ[1] == '?'){equ[1] = balloons[i][3]}
						else if (equ[2] == '?'){equ[2] = balloons[i][3]}
						else if (equ[3] == '?' && equ[4] != '?'){equ[3] = balloons[i][3];compute_equation();}
						else if (equ[3] == '?'){equ[3] = balloons[i][3]}
						else if (equ[4] == '?'){equ[4] = balloons[i][3];compute_equation();}
					}
					else{score -= 15}
					balloons.splice(i,1);
				}
			}
		}
		
		})
		document.addEventListener('touchend', function(){popped_this_click=false})
		document.onmouseup=function(){popped_this_click=false}
		

		
		function change_to_equation(){
			equ[0] = level_array[level][1];
			equ[1] = level_array[level][2];
			equ[2] = level_array[level][3];
			equ[3] = level_array[level][4];
			equ[4] = level_array[level][5];
			bad_equation = false;
		}
		
		function startBalloons(){
			setInterval(function(){
				if(!at_menu_screen){
				var t = Math.floor(Math.random()*4)+1;
				var s;
				var blue_array = [0,1,2,3,4,5,6,7,8,9,'-','*','+','/']
				switch(t){
					case 1:
						s = '+'
						break;
					case 2:
						s = '-'
						break;
					case 3:
						s = '/'
						break;
					case 4:
						s = '*'
						break;
				}
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'r',Math.floor((Math.random()*9)+1)])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'b',blue_array[Math.floor(Math.random()*blue_array.length)]])
			balloons.push([Math.random()*(360-balloon_w),480+Math.random()*100,'g',s])
				}
			},1500)
			
		}
	
		//check for collisions
	function checkCollision(){
		for (i=0;i<balloons.length;i++){
			if (balloons[i][1] < -balloon_h){
				balloons.splice(i,1)
			}
		}
	}
	function gameOver(){
		if(localStorage.getItem('balloon_score')){
			if (score > localStorage.getItem('balloon_score')){localStorage.setItem('balloon_score',score)}
			var highscore = localStorage.getItem('balloon_score')
		}
		else{localStorage.setItem('balloon_score',score)}
			alert('Game Over\nYour score: '+score+'\nHighscore: '+highscore)
			score = 0
	}

	function updateScore(){
			
			ctx.fillStyle = 'yellow'
			ctx.font='28px Georgia'
			ctx.fillText('Score: '+score,25,25)
		}
		//loop game
	function gameLoop(){
			ctx.clearRect(0,0,720,480)
			drawBackground()
			if (at_menu_screen){
				main_menu()
			}
			else{
				drawBalloons()
				drawGoal()
				updateScore()
				checkCollision()
			}
			requestAnimationFrame(gameLoop)
		}
		//initialize game
	function init(){
			startBalloons()
			gameLoop()
			change_to_equation()
		}
	
		
	function log(){
			ctx.drawImage(balloon_red3,100,100)
		}
	</script>
</body>
</html>
